<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Steam trade helper</title>
  <style type="text/css">@import url(css/main.css);</style>

  <script src="http://code.jquery.com/jquery-1.12.3.min.js"></script>
  <script src="js/common.js"></script>
  <script src="js/objects.js"></script>
  <script>
    var repoUrl = 'rest/raw/prices';
    var QUALITIES = ["1", "3", "6", "11", "13", "14"]; // indexes of genuine, vintage, unique, strange, haunted, collector's items
    var items;

    document.addEventListener("DOMContentLoaded", doTheJob);

    function doTheJob() {
      try {
        if (items == null) {
          items = getItems();
        }

        renderTableRows(items);
      } catch (Error) {
        console.log(Error.message);
      }
    }

    function getItems() {
      return JSON.parse(getResource(repoUrl)).response.items;
    }

    function renderTableRows(items) {
      var view = $("tbody");
      view.empty();

      var count = 1;
      for (var item in items) {
        if (!items.hasOwnProperty(item)) {
          continue;
        }

        var tableRow = view.append("<tr>");
        tableRow.append("<td class='nominal'>" + (count++) + "</td>");
        tableRow.append("<td>" + item + "</td>");

        var qualities = items[item].prices;

        var keys = Object.keys(qualities); // returns an array of strings
        for (var i = 0; i < QUALITIES.length; i++) {
          var pos = keys.indexOf(QUALITIES[i]);

          if (pos >= 0) {
            console.log(keys[pos]);
            tableRow.append("<td>" + keys[pos] + "</td>");
          } else {
            tableRow.append("<td></td>");
          }
        }
      }
    }
  </script>
</head>

<body>
  <input id="in" type="text" title="input for text query"/>
  <button id="btnSearch" onclick="doTheJob()">doTheJob</button>

  <table id="view">
    <thead id="header">
      <tr>
        <th>#</th>
        <th>Item name</th>
        <th>Genuine</th>
        <th>Vintage</th>
        <th>Unique</th>
        <th>Strange</th>
        <th>Haunted</th>
        <th>Collector's</th>
      </tr>
    </thead>

    <tbody></tbody>
  </table>

</body>
</html>