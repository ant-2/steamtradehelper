<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Trade helper</title>
  <style type="text/css">@import url(js/modules/spreadsheet.css);</style>

  <!-- External libs -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.13.1/lodash.js"></script>
  <script src="http://code.jquery.com/jquery-1.12.4.min.js"></script>

  <!-- Internal libs -->
  <script src="js/common.js"></script>
  <script src="js/data.js"></script>
  <script src="js/prices.js"></script>
  <script src="js/modules/spreadsheet.js"></script>

  <!-- Templates -->
  <script type="text/template" id="titleTmpl">
  <div class="sh-title"><%-itemName%></div>
  </script>
  <script type="text/template" id="pricesTmpl">
  <% _.forIn(item, function(price) { %>
  <div class="sh-cell"><%-price.value+" "+price.currency%></div>
  <%}) %>
  </script>

  <script>
    document.addEventListener("DOMContentLoaded", init);

    function init() {
      // retrieves data from a server
      var items, dataSupplier, parser, rawPrices;
      try {
        dataSupplier = new BackpacktfDataSupplier();
        rawPrices = dataSupplier.getPrices();
        parser = new PricesApiParser(rawPrices);
        items = parser.getAllItems();
      } catch (e) {
        console.log('Error in attempt to get data from server. ' + e.name + ": " + e.message);
      }

      var input, spreadsheet;
      try {
        spreadsheet = new Spreadsheet({
          containerClass: "sh",
          titleTmpl: _.template(document.getElementById('titleTmpl').innerHTML, {sourceURL: '/titleTmpl'}),
          pricesTmpl: _.template(document.getElementById('pricesTmpl').innerHTML, {sourceURL: '/pricesTmpl'}),
          items: items
        });
        input = new Input({
          inputTmpl: _.template(document.getElementById('inputTmpl').innerHTML, {sourceURL: '/inputTmpl'}),
          labelText: "label",
          buttonText: "button",
          buttonFunc: spreadsheet.filter
        });

        document.body.appendChild(input.getElem());
        document.body.appendChild(spreadsheet.getElem());
      } catch (e) {
        console.log("Error in rendering page content. "+e.name+": "+e.message)
      }
    }
  </script>
</head>

<body>
</body>
</html>